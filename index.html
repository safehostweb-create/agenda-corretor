<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda do Corretor - Sistema de Agendamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { box-sizing: border-box; }
        .notification { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .property-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .time-slot { transition: all 0.2s ease; }
        .available:hover { transform: scale(1.05); }
        .available { background: linear-gradient(135deg, #10b981, #059669); cursor: pointer; }
        .occupied { background: linear-gradient(135deg, #ef4444, #dc2626); cursor: not-allowed; }
        .blocked { background: linear-gradient(135deg, #f59e0b, #d97706); cursor: pointer; }
        .pending { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .calendar-day { min-height: 120px; }
        .calendar-day:hover { background-color: #f8fafc; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">üè† Agenda do Corretor</h1>
                <p class="text-gray-600 mt-2">Seu sistema de agendamentos</p>
            </div>
            <form class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usu√°rio</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg pr-10 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <span id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer text-gray-500 hover:text-gray-700">üëÅÔ∏è</span>
                    </div>
                </div>
                <button type="button" id="loginButton" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all">Entrar</button>
            </form>
            <div class="mt-4 text-center">
                <button id="showRegister" class="text-blue-600 hover:text-blue-700 text-sm font-medium">N√£o tem conta? Cadastre-se aqui</button>
            </div>
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-600"><strong>Demo:</strong> Usu√°rio: corretor / Senha: 123456</p>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">üìù Cadastro de Corretor</h1>
                <p class="text-gray-600 mt-2">Crie sua conta</p>
            </div>
            <form class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="regName" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="regEmail" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">WhatsApp</label>
                        <input type="tel" id="regPhone" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="(11) 99999-9999" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Cidade</label>
                        <input type="text" id="regCity" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <hr class="my-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Usu√°rio (para login)</label>
                    <input type="text" id="regUsername" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Senha</label>
                    <input type="password" id="regPassword" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Confirmar Senha</label>
                    <input type="password" id="regConfirmPassword" class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <button type="button" id="registerButton" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition-all">Criar Conta</button>
            </form>
            <div class="mt-4 text-center">
                <button id="showLogin" class="text-blue-600 hover:text-blue-700 text-sm font-medium">J√° tem conta? Fa√ßa login</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold text-gray-800">üè† Agenda do Corretor</h1>
                        <span id="welcomeUser" class="text-gray-600"></span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="dashboardBtn" class="px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">Dashboard</button>
                        <button id="calendarBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors">Agenda</button>
                        <button id="addPropertyBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">+ Adicionar Im√≥vel</button>
                        <button id="logoutBtn" class="text-gray-600 hover:text-gray-800">Sair</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard View -->
        <div id="dashboardView" class="max-w-7xl mx-auto px-4 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-semibold mb-6">Meus Im√≥veis</h2>
                        <div id="propertiesList" class="space-y-4">
                            <!-- Properties will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Agenda de Hoje</h3>
                        <div id="todaySchedule" class="space-y-3">
                            <!-- Today's schedule will be loaded here -->
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Estat√≠sticas</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Im√≥veis cadastrados:</span>
                                <span id="totalProperties" class="font-semibold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Visitas hoje:</span>
                                <span id="todayVisits" class="font-semibold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Visitas esta semana:</span>
                                <span id="weekVisits" class="font-semibold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Hor√°rios bloqueados:</span>
                                <span id="blockedSlots" class="font-semibold">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Pr√≥ximas Visitas</h3>
                        <div id="upcomingVisits" class="space-y-3">
                            <!-- Upcoming visits will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarView" class="hidden max-w-7xl mx-auto px-4 py-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold">Minha Agenda</h2>
                    <div class="flex items-center space-x-4">
                        <button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-lg">‚Üê</button>
                        <span id="currentMonth" class="text-lg font-medium"></span>
                        <button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-lg">‚Üí</button>
                    </div>
                </div>
                
                <div class="mb-4 flex flex-wrap gap-4 text-sm">
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-green-500 to-green-600 rounded"></div>
                        <span>Dispon√≠vel</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-red-500 to-red-600 rounded"></div>
                        <span>Ocupado</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded"></div>
                        <span>Bloqueado</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-4 h-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded"></div>
                        <span>Pendente</span>
                    </div>
                </div>

                <div id="calendar" class="grid grid-cols-7 gap-1">
                    <!-- Calendar will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Property Modal -->
    <div id="addPropertyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Adicionar Novo Im√≥vel</h2>
                <button id="closeAddModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="addPropertyForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo do Im√≥vel</label>
                        <select id="propertyType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecione o tipo</option>
                            <option value="casa">Casa</option>
                            <option value="apartamento">Apartamento</option>
                            <option value="terreno">Terreno</option>
                            <option value="comercial">Comercial</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                        <input type="number" id="propertyPrice" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Endere√ßo Completo</label>
                    <input type="text" id="propertyAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Quartos</label>
                        <input type="number" id="propertyRooms" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Banheiros</label>
                        <input type="number" id="propertyBathrooms" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">√Årea (m¬≤)</label>
                        <input type="number" id="propertyArea" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" min="0">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                    <textarea id="propertyDescription" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancelAddProperty" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Adicionar Im√≥vel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Agendar Visita</h2>
                <button id="closeScheduleModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="scheduleContent">
                <!-- Schedule content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Block Time Modal -->
    <div id="blockTimeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Bloquear Hor√°rio</h2>
                <button id="closeBlockModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <form id="blockTimeForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Data e Hor√°rio</label>
                    <input type="text" id="blockDateTime" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Motivo do Bloqueio</label>
                    <select id="blockReason" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        <option value="">Selecione o motivo</option>
                        <option value="Consulta M√©dica">Consulta M√©dica</option>
                        <option value="Almo√ßo">Almo√ßo</option>
                        <option value="Reuni√£o">Reuni√£o</option>
                        <option value="Compromisso Pessoal">Compromisso Pessoal</option>
                        <option value="Viagem">Viagem</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div id="customReasonDiv" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Especifique o motivo</label>
                    <input type="text" id="customReason" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes (opcional)</label>
                    <textarea id="blockNotes" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancelBlockTime" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
                    <button type="submit" class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">Bloquear Hor√°rio</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Day Schedule Modal -->
    <div id="dayScheduleModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 id="dayScheduleTitle" class="text-2xl font-bold"></h2>
                <button id="closeDayScheduleModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="dayScheduleContent">
                <!-- Day schedule content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let users = JSON.parse(localStorage.getItem('agendaUsers') || '{}');
        let properties = JSON.parse(localStorage.getItem('agendaProperties') || '{}');
        let appointments = JSON.parse(localStorage.getItem('agendaAppointments') || '{}');
        let blockedTimes = JSON.parse(localStorage.getItem('agendaBlockedTimes') || '{}');
        let currentUser = null;
        let currentDate = new Date();
        let currentView = 'dashboard';

        // Initialize demo data
        if (!users['corretor']) {
            users['corretor'] = {
                username: 'corretor',
                password: '123456',
                name: 'Jo√£o Silva',
                email: 'joao@corretor.com',
                phone: '(11) 99999-9999',
                city: 'S√£o Paulo'
            };
            saveData();
        }

        function saveData() {
            localStorage.setItem('agendaUsers', JSON.stringify(users));
            localStorage.setItem('agendaProperties', JSON.stringify(properties));
            localStorage.setItem('agendaAppointments', JSON.stringify(appointments));
            localStorage.setItem('agendaBlockedTimes', JSON.stringify(blockedTimes));
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification p-4 rounded-lg text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            notification.textContent = message;
            document.getElementById('notifications').appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Navigation
        function switchView(view) {
            document.getElementById('dashboardView').classList.toggle('hidden', view !== 'dashboard');
            document.getElementById('calendarView').classList.toggle('hidden', view !== 'calendar');
            
            document.getElementById('dashboardBtn').classList.toggle('text-blue-600', view === 'dashboard');
            document.getElementById('dashboardBtn').classList.toggle('text-gray-600', view !== 'dashboard');
            document.getElementById('calendarBtn').classList.toggle('text-blue-600', view === 'calendar');
            document.getElementById('calendarBtn').classList.toggle('text-gray-600', view !== 'calendar');
            
            currentView = view;
            
            if (view === 'calendar') {
                generateCalendar();
            } else {
                loadDashboard();
            }
        }

        document.getElementById('dashboardBtn').addEventListener('click', () => switchView('dashboard'));
        document.getElementById('calendarBtn').addEventListener('click', () => switchView('calendar'));

        // Login functionality
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        document.getElementById('loginButton').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showNotification('Por favor, preencha todos os campos', 'error');
                return;
            }

            if (users[username] && users[username].password === password) {
                currentUser = username;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('welcomeUser').textContent = `Ol√°, ${users[username].name}`;
                switchView('dashboard');
                showNotification('Login realizado com sucesso!');
            } else {
                showNotification('Usu√°rio ou senha incorretos', 'error');
            }
        });

        // Registration functionality
        document.getElementById('showRegister').addEventListener('click', function() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        });

        document.getElementById('showLogin').addEventListener('click', function() {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        document.getElementById('registerButton').addEventListener('click', function() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const city = document.getElementById('regCity').value;
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (!name || !email || !phone || !city || !username || !password || !confirmPassword) {
                showNotification('Por favor, preencha todos os campos', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('As senhas n√£o coincidem', 'error');
                return;
            }

            if (users[username]) {
                showNotification('Este usu√°rio j√° existe', 'error');
                return;
            }

            users[username] = { name, email, phone, city, username, password };
            saveData();
            showNotification('Conta criada com sucesso!');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Logout realizado com sucesso!');
        });

        // Add property functionality
        document.getElementById('addPropertyBtn').addEventListener('click', function() {
            document.getElementById('addPropertyModal').classList.remove('hidden');
        });

        document.getElementById('closeAddModal').addEventListener('click', function() {
            document.getElementById('addPropertyModal').classList.add('hidden');
        });

        document.getElementById('cancelAddProperty').addEventListener('click', function() {
            document.getElementById('addPropertyModal').classList.add('hidden');
        });

        document.getElementById('addPropertyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const propertyData = {
                id: Date.now().toString(),
                owner: currentUser,
                type: document.getElementById('propertyType').value,
                price: document.getElementById('propertyPrice').value,
                address: document.getElementById('propertyAddress').value,
                rooms: document.getElementById('propertyRooms').value,
                bathrooms: document.getElementById('propertyBathrooms').value,
                area: document.getElementById('propertyArea').value,
                description: document.getElementById('propertyDescription').value,
                createdAt: new Date().toISOString()
            };

            if (!properties[currentUser]) {
                properties[currentUser] = [];
            }
            properties[currentUser].push(propertyData);
            saveData();
            
            document.getElementById('addPropertyModal').classList.add('hidden');
            document.getElementById('addPropertyForm').reset();
            if (currentView === 'dashboard') {
                loadProperties();
            }
            showNotification('Im√≥vel adicionado com sucesso!');
        });

        // Schedule modal functionality
        document.getElementById('closeScheduleModal').addEventListener('click', function() {
            document.getElementById('scheduleModal').classList.add('hidden');
        });

        // Block time modal functionality
        document.getElementById('closeBlockModal').addEventListener('click', function() {
            document.getElementById('blockTimeModal').classList.add('hidden');
        });

        document.getElementById('cancelBlockTime').addEventListener('click', function() {
            document.getElementById('blockTimeModal').classList.add('hidden');
        });

        document.getElementById('blockReason').addEventListener('change', function() {
            const customDiv = document.getElementById('customReasonDiv');
            if (this.value === 'Outro') {
                customDiv.classList.remove('hidden');
                document.getElementById('customReason').required = true;
            } else {
                customDiv.classList.add('hidden');
                document.getElementById('customReason').required = false;
            }
        });

        document.getElementById('blockTimeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dateTime = document.getElementById('blockDateTime').value;
            const reason = document.getElementById('blockReason').value;
            const customReason = document.getElementById('customReason').value;
            const notes = document.getElementById('blockNotes').value;
            
            const finalReason = reason === 'Outro' ? customReason : reason;
            
            const blockData = {
                id: Date.now().toString(),
                owner: currentUser,
                dateTime: dateTime,
                reason: finalReason,
                notes: notes,
                createdAt: new Date().toISOString()
            };

            if (!blockedTimes[currentUser]) {
                blockedTimes[currentUser] = [];
            }
            blockedTimes[currentUser].push(blockData);
            saveData();
            
            document.getElementById('blockTimeModal').classList.add('hidden');
            document.getElementById('blockTimeForm').reset();
            document.getElementById('customReasonDiv').classList.add('hidden');
            
            if (currentView === 'calendar') {
                generateCalendar();
            } else {
                loadDashboard();
            }
            showNotification('Hor√°rio bloqueado com sucesso!');
        });

        // Day schedule modal functionality
        document.getElementById('closeDayScheduleModal').addEventListener('click', function() {
            document.getElementById('dayScheduleModal').classList.add('hidden');
        });

        // Calendar functionality
        document.getElementById('prevMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', function() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        });

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            calendar.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'p-2 text-center font-semibold text-gray-600 bg-gray-50';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Add calendar days
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = `calendar-day border border-gray-200 p-2 cursor-pointer ${
                    date.getMonth() !== currentDate.getMonth() ? 'text-gray-400 bg-gray-50' : 'bg-white'
                }`;
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'font-semibold mb-1';
                dayNumber.textContent = date.getDate();
                dayElement.appendChild(dayNumber);
                
                // Add appointments and blocked times for this day
                const dayAppointments = getDaySchedule(date);
                dayAppointments.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = `text-xs p-1 mb-1 rounded text-white ${
                        item.type === 'appointment' ? 'bg-blue-500' : 'bg-yellow-500'
                    }`;
                    itemElement.textContent = `${item.time} - ${item.title}`;
                    dayElement.appendChild(itemElement);
                });
                
                dayElement.addEventListener('click', () => openDaySchedule(date));
                calendar.appendChild(dayElement);
            }
        }

        function getDaySchedule(date) {
            const dateStr = date.toDateString();
            const schedule = [];
            
            // Add appointments
            const userAppointments = appointments[currentUser] || [];
            userAppointments.forEach(apt => {
                if (new Date(apt.date).toDateString() === dateStr) {
                    schedule.push({
                        type: 'appointment',
                        time: apt.time,
                        title: apt.clientName,
                        data: apt
                    });
                }
            });
            
            // Add blocked times
            const userBlocked = blockedTimes[currentUser] || [];
            userBlocked.forEach(block => {
                const blockDate = new Date(block.dateTime);
                if (blockDate.toDateString() === dateStr) {
                    schedule.push({
                        type: 'blocked',
                        time: blockDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
                        title: block.reason,
                        data: block
                    });
                }
            });
            
            return schedule.sort((a, b) => a.time.localeCompare(b.time));
        }

        function openDaySchedule(date) {
            const daySchedule = getDaySchedule(date);
            const dateStr = date.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('dayScheduleTitle').textContent = `Agenda - ${dateStr}`;
            
            const content = document.getElementById('dayScheduleContent');
            
            if (daySchedule.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="mb-4">Nenhum compromisso agendado para este dia</p>
                        <div class="space-y-2">
                            <p class="text-sm">Hor√°rios dispon√≠veis para agendamento:</p>
                            <div class="grid grid-cols-3 gap-2 max-w-md mx-auto">
                                ${getAvailableSlots(date).map(slot => 
                                    `<button onclick="blockTimeSlot('${date.toISOString()}', '${slot}')" 
                                     class="time-slot available text-white px-3 py-2 rounded-lg text-sm">
                                        ${slot}
                                    </button>`
                                ).join('')}
                            </div>
                            <p class="text-xs text-gray-400 mt-2">Clique em um hor√°rio para bloque√°-lo</p>
                        </div>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="space-y-4">
                        ${daySchedule.map(item => `
                            <div class="border border-gray-200 rounded-lg p-4 ${
                                item.type === 'appointment' ? 'border-blue-200 bg-blue-50' : 'border-yellow-200 bg-yellow-50'
                            }">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="font-semibold text-lg">${item.time} - ${item.title}</div>
                                        ${item.type === 'appointment' ? `
                                            <div class="text-sm text-gray-600 mt-1">
                                                <p>üìû ${item.data.clientPhone}</p>
                                                ${item.data.clientEmail ? `<p>üìß ${item.data.clientEmail}</p>` : ''}
                                                <p>üè† ${item.data.propertyAddress}</p>
                                                ${item.data.notes ? `<p class="mt-2 italic">${item.data.notes}</p>` : ''}
                                            </div>
                                        ` : `
                                            <div class="text-sm text-gray-600 mt-1">
                                                <p>üö´ Hor√°rio bloqueado</p>
                                                ${item.data.notes ? `<p class="italic">${item.data.notes}</p>` : ''}
                                            </div>
                                        `}
                                    </div>
                                    <div class="flex space-x-2">
                                        ${item.type === 'blocked' ? `
                                            <button onclick="removeBlockedTime('${item.data.id}')" 
                                                    class="text-red-600 hover:text-red-800 text-sm">
                                                Desbloquear
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <div class="mt-6 pt-4 border-t">
                            <p class="text-sm text-gray-600 mb-2">Hor√°rios ainda dispon√≠veis:</p>
                            <div class="grid grid-cols-3 gap-2">
                                ${getAvailableSlots(date).map(slot => 
                                    `<button onclick="blockTimeSlot('${date.toISOString()}', '${slot}')" 
                                     class="time-slot available text-white px-3 py-2 rounded-lg text-sm">
                                        ${slot}
                                    </button>`
                                ).join('')}
                            </div>
                            ${getAvailableSlots(date).length > 0 ? 
                                '<p class="text-xs text-gray-400 mt-2">Clique em um hor√°rio para bloque√°-lo</p>' : 
                                '<p class="text-sm text-gray-500">Todos os hor√°rios est√£o ocupados</p>'
                            }
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('dayScheduleModal').classList.remove('hidden');
        }

        function getAvailableSlots(date) {
            const slots = ['08:00', '09:00', '10:00', '11:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            const daySchedule = getDaySchedule(date);
            const occupiedSlots = daySchedule.map(item => item.time);
            
            return slots.filter(slot => !occupiedSlots.includes(slot));
        }

        function blockTimeSlot(dateStr, time) {
            const date = new Date(dateStr);
            const dateTimeStr = `${date.toLocaleDateString('pt-BR')} √†s ${time}`;
            
            document.getElementById('blockDateTime').value = dateTimeStr;
            document.getElementById('blockTimeModal').classList.remove('hidden');
            
            // Store the actual datetime for saving
            const [hours, minutes] = time.split(':');
            date.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            document.getElementById('blockTimeModal').dataset.datetime = date.toISOString();
        }

        // Update the block time form to use the stored datetime
        document.getElementById('blockTimeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dateTime = document.getElementById('blockTimeModal').dataset.datetime;
            const reason = document.getElementById('blockReason').value;
            const customReason = document.getElementById('customReason').value;
            const notes = document.getElementById('blockNotes').value;
            
            const finalReason = reason === 'Outro' ? customReason : reason;
            
            const blockData = {
                id: Date.now().toString(),
                owner: currentUser,
                dateTime: dateTime,
                reason: finalReason,
                notes: notes,
                createdAt: new Date().toISOString()
            };

            if (!blockedTimes[currentUser]) {
                blockedTimes[currentUser] = [];
            }
            blockedTimes[currentUser].push(blockData);
            saveData();
            
            document.getElementById('blockTimeModal').classList.add('hidden');
            document.getElementById('blockTimeForm').reset();
            document.getElementById('customReasonDiv').classList.add('hidden');
            document.getElementById('dayScheduleModal').classList.add('hidden');
            
            if (currentView === 'calendar') {
                generateCalendar();
            } else {
                loadDashboard();
            }
            showNotification('Hor√°rio bloqueado com sucesso!');
        });

        function removeBlockedTime(blockId) {
            if (!blockedTimes[currentUser]) return;
            
            blockedTimes[currentUser] = blockedTimes[currentUser].filter(block => block.id !== blockId);
            saveData();
            
            document.getElementById('dayScheduleModal').classList.add('hidden');
            
            if (currentView === 'calendar') {
                generateCalendar();
            } else {
                loadDashboard();
            }
            showNotification('Hor√°rio desbloqueado com sucesso!');
        }

        function loadDashboard() {
            loadProperties();
            loadTodaySchedule();
            loadUpcomingVisits();
            updateStats();
        }

        function loadProperties() {
            const propertiesList = document.getElementById('propertiesList');
            const userProperties = properties[currentUser] || [];
            
            if (userProperties.length === 0) {
                propertiesList.innerHTML = '<div class="text-center py-8 text-gray-500">Nenhum im√≥vel cadastrado ainda. Clique em "Adicionar Im√≥vel" para come√ßar.</div>';
                return;
            }

            propertiesList.innerHTML = userProperties.map(property => `
                <div class="property-card border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-all">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-lg">${property.type.charAt(0).toUpperCase() + property.type.slice(1)} - R$ ${parseInt(property.price).toLocaleString('pt-BR')}</h3>
                            <p class="text-gray-600">${property.address}</p>
                        </div>
                        <button onclick="openScheduleModal('${property.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Agendar Visita</button>
                    </div>
                    <div class="flex space-x-4 text-sm text-gray-600 mb-3">
                        ${property.rooms ? `<span>üõèÔ∏è ${property.rooms} quartos</span>` : ''}
                        ${property.bathrooms ? `<span>üöø ${property.bathrooms} banheiros</span>` : ''}
                        ${property.area ? `<span>üìê ${property.area}m¬≤</span>` : ''}
                    </div>
                    ${property.description ? `<p class="text-gray-700 text-sm">${property.description}</p>` : ''}
                </div>
            `).join('');
        }

        function loadTodaySchedule() {
            const todaySchedule = document.getElementById('todaySchedule');
            const today = new Date();
            const todayItems = getDaySchedule(today);

            if (todayItems.length === 0) {
                todaySchedule.innerHTML = '<div class="text-gray-500 text-sm">Nenhum compromisso para hoje</div>';
                return;
            }

            todaySchedule.innerHTML = todayItems.map(item => `
                <div class="border-l-4 ${item.type === 'appointment' ? 'border-blue-500' : 'border-yellow-500'} pl-3 py-2">
                    <div class="font-medium">${item.time}</div>
                    <div class="text-sm text-gray-600">${item.title}</div>
                    ${item.type === 'appointment' ? 
                        `<div class="text-xs text-gray-500">${item.data.propertyAddress}</div>` : 
                        `<div class="text-xs text-gray-500">Hor√°rio bloqueado</div>`
                    }
                </div>
            `).join('');
        }

        function loadUpcomingVisits() {
            const upcomingVisits = document.getElementById('upcomingVisits');
            const userAppointments = appointments[currentUser] || [];
            const today = new Date();
            
            const upcoming = userAppointments
                .filter(apt => new Date(apt.date) > today)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 5);

            if (upcoming.length === 0) {
                upcomingVisits.innerHTML = '<div class="text-gray-500 text-sm">Nenhuma visita agendada</div>';
                return;
            }

            upcomingVisits.innerHTML = upcoming.map(apt => `
                <div class="border-l-4 border-green-500 pl-3 py-2">
                    <div class="font-medium">${new Date(apt.date).toLocaleDateString('pt-BR')} - ${apt.time}</div>
                    <div class="text-sm text-gray-600">${apt.clientName}</div>
                    <div class="text-xs text-gray-500">${apt.propertyAddress}</div>
                </div>
            `).join('');
        }

        function updateStats() {
            const userProperties = properties[currentUser] || [];
            const userAppointments = appointments[currentUser] || [];
            const userBlocked = blockedTimes[currentUser] || [];
            const today = new Date().toDateString();
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());

            document.getElementById('totalProperties').textContent = userProperties.length;
            document.getElementById('todayVisits').textContent = userAppointments.filter(apt => new Date(apt.date).toDateString() === today).length;
            document.getElementById('weekVisits').textContent = userAppointments.filter(apt => new Date(apt.date) >= weekStart).length;
            document.getElementById('blockedSlots').textContent = userBlocked.length;
        }

        function openScheduleModal(propertyId) {
            const property = properties[currentUser].find(p => p.id === propertyId);
            if (!property) return;

            document.getElementById('scheduleModal').classList.remove('hidden');
            document.getElementById('scheduleContent').innerHTML = `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-2">${property.type.charAt(0).toUpperCase() + property.type.slice(1)} - R$ ${parseInt(property.price).toLocaleString('pt-BR')}</h3>
                    <p class="text-gray-600">${property.address}</p>
                </div>
                
                <form id="scheduleForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Cliente</label>
                            <input type="text" id="clientName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">WhatsApp</label>
                            <input type="tel" id="clientPhone" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="(11) 99999-9999" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email (opcional)</label>
                        <input type="email" id="clientEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data da Visita</label>
                            <input type="date" id="visitDate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required min="${new Date().toISOString().split('T')[0]}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hor√°rio</label>
                            <select id="visitTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Selecione o hor√°rio</option>
                                <option value="08:00">08:00</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                        <textarea id="visitNotes" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Informa√ß√µes adicionais sobre a visita..."></textarea>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-medium text-blue-800 mb-2">üì± Notifica√ß√µes WhatsApp</h4>
                        <p class="text-sm text-blue-700">
                            Ap√≥s confirmar o agendamento, tanto voc√™ quanto o cliente receber√£o uma notifica√ß√£o no WhatsApp com os detalhes da visita.
                            <br><small class="text-blue-600">* Funcionalidade dispon√≠vel com integra√ß√£o de API WhatsApp</small>
                        </p>
                    </div>
                    <div class="flex justify-end space-x-4 pt-4">
                        <button type="button" onclick="document.getElementById('scheduleModal').classList.add('hidden')" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancelar</button>
                        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Agendar Visita</button>
                    </div>
                </form>
            `;

            document.getElementById('scheduleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const appointmentData = {
                    id: Date.now().toString(),
                    propertyId: propertyId,
                    propertyAddress: property.address,
                    clientName: document.getElementById('clientName').value,
                    clientPhone: document.getElementById('clientPhone').value,
                    clientEmail: document.getElementById('clientEmail').value,
                    date: document.getElementById('visitDate').value,
                    time: document.getElementById('visitTime').value,
                    notes: document.getElementById('visitNotes').value,
                    status: 'agendado',
                    createdAt: new Date().toISOString()
                };

                if (!appointments[currentUser]) {
                    appointments[currentUser] = [];
                }
                appointments[currentUser].push(appointmentData);
                saveData();
                
                document.getElementById('scheduleModal').classList.add('hidden');
                
                if (currentView === 'dashboard') {
                    loadDashboard();
                } else {
                    generateCalendar();
                }
                
                // Simulate WhatsApp notification (in real implementation, this would call the API)
                showNotification('Visita agendada! Notifica√ß√µes WhatsApp ser√£o enviadas quando a API estiver integrada.');
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('username').focus();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'985ae561723bcaf8',t:'MTc1ODk3NTAwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
